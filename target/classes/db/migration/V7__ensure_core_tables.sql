-- V7: Ensure core tables exist (USUARIO, PATIO, VAGA, MOTO) - Oracle-safe

-- USUARIO
DECLARE v_exists NUMBER; BEGIN
  SELECT COUNT(*) INTO v_exists FROM user_tables WHERE table_name = 'USUARIO';
  IF v_exists = 0 THEN
    EXECUTE IMMEDIATE 'CREATE TABLE USUARIO (
      ID NUMBER(19) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
      NOME VARCHAR2(100) NOT NULL,
      EMAIL VARCHAR2(255) NOT NULL,
      SENHA VARCHAR2(255) NOT NULL,
      TIPO VARCHAR2(20) NOT NULL
    )';
  END IF;
END;
/

-- PATIO
DECLARE v_exists NUMBER; BEGIN
  SELECT COUNT(*) INTO v_exists FROM user_tables WHERE table_name = 'PATIO';
  IF v_exists = 0 THEN
    EXECUTE IMMEDIATE 'CREATE TABLE PATIO (
      ID NUMBER(19) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY
    )';
  END IF;
END;
/

-- VAGA
DECLARE v_exists NUMBER; BEGIN
  SELECT COUNT(*) INTO v_exists FROM user_tables WHERE table_name = 'VAGA';
  IF v_exists = 0 THEN
    EXECUTE IMMEDIATE 'CREATE TABLE VAGA (
      ID NUMBER(19) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
      NUMERO NUMBER(10) NOT NULL,
      STATUS VARCHAR2(20),
      TIPO VARCHAR2(30),
      PATIO_ID NUMBER(19) NOT NULL
    )';
  END IF;
END;
/

-- MOTO
DECLARE v_exists NUMBER; BEGIN
  SELECT COUNT(*) INTO v_exists FROM user_tables WHERE table_name = 'MOTO';
  IF v_exists = 0 THEN
    EXECUTE IMMEDIATE 'CREATE TABLE MOTO (
      ID NUMBER(19) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
      MODELO VARCHAR2(50) NOT NULL,
      PLACA VARCHAR2(10),
      CHASSI VARCHAR2(50),
      PROBLEMA_IDENTIFICADO VARCHAR2(255) NOT NULL,
      VAGA_ID NUMBER(19)
    )';
  END IF;
END;
/

